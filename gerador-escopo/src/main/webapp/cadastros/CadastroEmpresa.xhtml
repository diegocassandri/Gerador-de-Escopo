<ui:composition template="/WEB-INF/template/Layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">

	<f:metadata>
		<f:viewAction action="#{cadastroEmpresaBean.consultar}" />
	</f:metadata>

	<ui:define name="titulo">Cadastro de Empresa</ui:define>

	<ui:define name="corpo">
		<h1>Cadastro Empresa</h1>
		<h:form id="frmCadastro">

			<p:messages id="msgs" />

			<p:toolbar id="toolbar">
				<f:facet name="left">
					<p:commandButton value="Novo" icon="ui-icon-document"
						action="#{cadastroEmpresaBean.prepararNovoCadastro}"
						process="@this" update="empresa-dialog"
						oncomplete="PF('edicaoEmpresaDialog').show()">
						<p:resetInput target="empresa-dialog" />
					</p:commandButton>

					<span class="ui-separator"> <span
						class="ui-icon ui-icon-grip-dotted-vertical" />
					</span>

					<p:commandButton icon="ui-icon-pencil" title="Editar"
						process="@this" update="empresa-dialog"
						oncomplete="PF('edicaoEmpresaDialog').show()"
						disabled="#{cadastroEmpresaBean.empresaSelecionado == null}">
						<p:resetInput target="empresa-dialog" />

						<f:setPropertyActionListener
							value="#{cadastroEmpresaBean.empresaSelecionado}"
							target="#{cadastroEmpresaBean.empresaEdicao}" />
					</p:commandButton>

					<p:commandButton icon="ui-icon-trash" title="Excluir"
						process="@this" update="empresa-table msgs toolbar"
						action="#{cadastroEmpresaBean.excluir}"
						disabled="#{cadastroEmpresaBean.empresaSelecionado == null}">

						<p:confirm icon="ui-icon-alert" header="Confirmação de exclusão"
							message="Tem certeza que deseja excluir a empresa?" />

					</p:commandButton>
				</f:facet>

			</p:toolbar>

			<p:dataTable value="#{cadastroEmpresaBean.todasEmpresas}"
				var="empresa" emptyMessage="Nenhuma empresa cadastrada." rows="10"
				paginator="true" paginatorPosition="bottom" style="margin-top: 10px"
				id="empresa-table"
				selection="#{cadastroEmpresaBean.empresaSelecionado}"
				selectionMode="single" rowKey="#{empresa.codigo}"
				filteredValue="#{cadastroEmpresaBean.filtroEmpresas}"
				widgetVar="tabelaEmpresa">

				<p:ajax event="rowSelect" update=":frmCadastro:toolbar" />
				<p:ajax event="rowUnselect" update=":frmCadastro:toolbar" />

				<p:column headerText="Código" sortBy="#{empresa.codigo}"
					filterBy="#{empresa.codigo}" filterMatchMode="contains">
					<h:outputText value="#{empresa.codigo}" />
				</p:column>
				<p:column headerText="Razão Social" sortBy="#{empresa.razaosocial}"
					filterBy="#{empresa.razaosocial}" filterMatchMode="contains">
					<h:outputText value="#{empresa.razaosocial}" />
				</p:column>
			</p:dataTable>

			<p:dialog header="Nova empresa" widgetVar="edicaoEmpresaDialog"
				id="empresa-dialog" resizable="false" modal="true"
				closeOnEscape="true">

				<p:messages id="msgs-dialog" />

				<p:defaultCommand target="salvar-button" scope="empresa-dialog" />
				<p:outputPanel id="pnlPessoa">
					<h:panelGrid columns="2" id="painel-dialog">
						<p:outputLabel value="Código" for="codigo" />
						<p:inputText id="codigo" size="7" maxlength="10"
							value="#{cadastroEmpresaBean.empresaEdicao.codigo}"
							readonly="true" />

						<p:outputLabel value="Tipo de Empresa" for="tipo" />
						<p:selectOneMenu id="tipo"
							value="#{cadastroEmpresaBean.empresaEdicao.tipoEmpresa}">
							<f:selectItem itemLabel="Selecione" />
							<f:selectItems value="#{cadastroEmpresaBean.tiposEmpresas}"
								var="tipo" itemLabel="#{tipo.descricao}" itemValue="#{tipo}" />
							<p:ajax event="change" update="pnlPessoa" process="tipo" />
						</p:selectOneMenu>

						<p:outputLabel value="Razão Social" for="razaoSocial" />
						<p:inputText id="razaoSocial" size="80" maxlength="250"
							value="#{cadastroEmpresaBean.empresaEdicao.razaoSocial}" />

						<p:outputLabel value="Nome Fantasia" for="fantasia" />
						<p:inputText id="fantasia" size="80" maxlength="250"
							value="#{cadastroEmpresaBean.empresaEdicao.fantasia}" />


						<p:outputLabel value="CNPJ" for="cnpj"
							rendered="#{cadastroEmpresaBean.empresaEdicao.tipoEmpresa=='JURIDICA'}" />
						<p:inputMask id="cnpj" size="18" maxlength="18"
							rendered="#{cadastroEmpresaBean.empresaEdicao.tipoEmpresa=='JURIDICA'}"
							value="#{cadastroEmpresaBean.empresaEdicao.cnpj}"
							mask="99.999.999/9999-99" />

						<p:outputLabel value="CPF" for="cpf"
							rendered="#{cadastroEmpresaBean.empresaEdicao.tipoEmpresa=='FISICA'}" />
						<p:inputMask id="cpf" size="14" maxlength="18"
							rendered="#{cadastroEmpresaBean.empresaEdicao.tipoEmpresa=='FISICA'}"
							value="#{cadastroEmpresaBean.empresaEdicao.cpf}"
							mask="999.999.999-99" />

						<p:outputLabel value="Inscrição Estadual" for="inscricao" />
						<p:inputText id="inscricao" size="25" maxlength="25"
							value="#{cadastroEmpresaBean.empresaEdicao.incricaoEstadual}" />

						<p:outputLabel value="Endereço" for="endereco" />
						<p:inputText id="endereco" size="80" maxlength="400"
							value="#{cadastroEmpresaBean.empresaEdicao.endereco}" />
						
						<p:outputLabel value="Número" for="numero" />
						<p:inputText id="numero" size="20" maxlength="20"
							value="#{cadastroEmpresaBean.empresaEdicao.numero}" />
						
						<p:outputLabel value="Bairro" for="bairro" />
						<p:inputText id="bairro" size="80" maxlength="250"
							value="#{cadastroEmpresaBean.empresaEdicao.numero}" />
								
						<p:commandButton value="Salvar" id="salvar-button"
							action="#{cadastroEmpresaBean.salvar}" process="empresa-dialog"
							update="msgs-dialog painel-dialog"
							oncomplete="if (!args.validationFailed) PF('edicaoEmpresaDialog').hide()" />
					</h:panelGrid>
				</p:outputPanel>
			</p:dialog>

		</h:form>
	</ui:define>
</ui:composition>